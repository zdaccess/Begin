from bs4 import BeautifulSoup

with open("../../materials/evilcorp.html") as fp:
    soup = BeautifulSoup(fp, 'html.parser')
    soup.title.string.replace_with("Evil Corp - Stealing your money every day")
    name = soup.find_all("span", "name")
    for find_name in name:
        find_pronoun = soup.find("span", "pronoun")
        if find_pronoun:
            h1 = soup.new_tag("h1")
            h1.string = find_name.text + ', you are hacked!'
            soup.html.body.insert(1, h1)
            parent_name = find_name.find_parent()
            parent_name.decompose()
    script_text = '''
                    hacked = function() {
                        alert('hacked');
                    }
                    window.addEventListener('load', 
                        function() { 
                            var f = document.querySelector("form");
                            f.setAttribute("onsubmit", "hacked()");
                        },
                        false
                    );
    '''
    script = soup.new_tag("script")
    script.string = script_text
    soup.html.body.insert(1, script)
    links = soup.find_all('a')
    for find in links:
        if (find.text == "Evil Corp"):
            find['href'] = "https://mrrobot.fandom.com/wiki/Fsociety"
            find.string = "Fsociety"
    with open("../../materials/evilcorp_hacked.html", "w") as file:
        file.write(str(soup))